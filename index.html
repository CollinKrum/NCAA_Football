<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸˆ NCAAF Betting Analysis Dashboard</title>
  <meta name="description" content="Comprehensive analysis of college football games and betting lines. Interactive charts, spread analysis, and conference breakdowns.">
  <meta property="og:title" content="NCAAF Betting Analysis Dashboard">
  <meta property="og:description" content="Interactive analysis of NCAAF betting lines and results.">
  <meta property="og:type" content="website">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color:#333; min-height:100vh;
    }
    .header {
      background: linear-gradient(90deg, #ff6b35 0%, #f7931e 100%);
      color:#fff; text-align:center; padding:20px;
      box-shadow:0 4px 8px rgba(0,0,0,.2);
    }
    .header h1 { font-size:2.2em; margin-bottom:8px; text-shadow:2px 2px 4px rgba(0,0,0,.3) }
    .header p { opacity:.9 }
    .container { max-width:1200px; margin:0 auto; padding:20px }
    .tabs { display:flex; justify-content:center; gap:8px; margin:20px 0; background:rgba(255,255,255,.1); border-radius:10px; padding:5px; flex-wrap:wrap }
    .tab { background:transparent; border:none; padding:12px 20px; color:#fff; cursor:pointer; border-radius:8px; font-size:15px; transition:.2s; }
    .tab:hover { background:rgba(255,255,255,.2) }
    .tab.active { background: linear-gradient(90deg, #ff6b35, #f7931e); box-shadow:0 4px 8px rgba(0,0,0,.2) }
    .tab-content { display:none }
    .tab-content.active { display:block; animation:fadeIn .35s ease }
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:none} }
    .filter-section, .analysis-section, .chart-container, .data-table {
      background:rgba(255,255,255,.95); border-radius:15px; padding:20px; margin:20px 0; box-shadow:0 8px 16px rgba(0,0,0,.1);
    }
    .filter-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(200px,1fr)); gap:15px }
    .filter-item { display:flex; flex-direction:column }
    .filter-item label { font-weight:600; color:#333; margin-bottom:6px }
    select, input { padding:10px; border:2px solid #ddd; border-radius:8px; font-size:14px }
    select:focus, input:focus { outline:none; border-color:#ff6b35 }
    .stats-grid { display:grid; grid-template-columns:repeat(auto-fit, minmax(240px,1fr)); gap:18px; margin:20px 0 }
    .stat-card { background:linear-gradient(135deg, rgba(255,255,255,.95), rgba(255,255,255,.85)); border-radius:15px; padding:22px; text-align:center; box-shadow:0 8px 16px rgba(0,0,0,.1) }
    .stat-number { font-size:2.2em; font-weight:700; color:#ff6b35; margin-bottom:8px }
    .stat-label { color:#333; font-weight:500 }
    .chart-title { font-size:1.2em; font-weight:600; color:#333; text-align:center; margin-bottom:12px }
    .chart-wrapper { position:relative; height:380px; }
    .two-column { display:grid; grid-template-columns:1fr 1fr; gap:24px }
    .insight-box { background:linear-gradient(90deg, #00b894, #00cec9); color:#fff; padding:12px; border-radius:10px; margin:12px 0 }
    .loading { text-align:center; color:#fff; font-size:1.1em; padding:30px }
    .spinner { border:4px solid rgba(255,255,255,.3); border-top:4px solid #ff6b35; border-radius:50%; width:40px; height:40px; animation:spin 1s linear infinite; margin:16px auto }
    @keyframes spin{ to{ transform:rotate(360deg) } }
    .footer { background:rgba(255,255,255,.1); color:#fff; text-align:center; padding:20px; margin-top:30px; border-radius:15px }
    table { width:100%; border-collapse:collapse }
    th, td { padding:12px; text-align:left; border-bottom:1px solid #ddd }
    th { background:#ff6b35; color:#fff; font-weight:600 }
    tr:hover { background:rgba(255,107,53,.1) }
    @media (max-width: 900px) { .two-column{ grid-template-columns:1fr } .header h1{ font-size:1.8em } }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸˆ NCAAF Betting Analysis Dashboard</h1>
    <p>Comprehensive Analysis of College Football Games & Betting Lines</p>
  </div>

  <div class="container">
    <div class="tabs">
      <button class="tab active" data-tab="overview">ğŸ“Š Overview</button>
      <button class="tab" data-tab="spreads">ğŸ“ˆ Spread Analysis</button>
      <button class="tab" data-tab="totals">ğŸ¯ Over/Under Analysis</button>
      <button class="tab" data-tab="trends">ğŸ“… Historical Trends</button>
      <button class="tab" data-tab="conferences">ğŸŸï¸ Conference Analysis</button>
      <button class="tab" data-tab="teams">ğŸˆ Team Analysis</button>
      <button class="tab" data-tab="yearly">ğŸ“… Year-by-Year Analysis</button>
    </div>

    <div id="loading" class="loading">
      <h2>ğŸˆ Loading NCAAF Data...</h2>
      <div class="spinner"></div>
      <p>Processing games and betting lines...</p>
    </div>

    <div id="overview" class="tab-content">
      <div class="filter-section">
        <h3>ğŸ›ï¸ Data Filters</h3>
        <div class="filter-grid">
          <div class="filter-item"><label for="seasonFilter">Season:</label><select id="seasonFilter" onchange="updateAnalysis()"><option value="all">All Seasons</option></select></div>
          <div class="filter-item"><label for="providerFilter">Sportsbook:</label><select id="providerFilter" onchange="updateAnalysis()"><option value="all">All Providers</option></select></div>
          <div class="filter-item"><label for="conferenceFilter">Conference:</label><select id="conferenceFilter" onchange="updateAnalysis()"><option value="all">All Conferences</option></select></div>
          <div class="filter-item"><label for="weekFilter">Week:</label><select id="weekFilter" onchange="updateAnalysis()"><option value="all">All Weeks</option></select></div>
          <div class="filter-item"><label for="teamFilter">Team:</label><select id="teamFilter" onchange="updateAnalysis()"><option value="all">All Teams</option></select></div>
          <div class="filter-item"><label for="conferenceYearFilter">Conference by Year:</label><select id="conferenceYearFilter" onchange="updateAnalysis()"><option value="all">All Conference-Years</option></select></div>
        </div>
      </div>
      <div id="overview-stats" class="stats-grid"></div>
      <div class="two-column">
        <div class="chart-container"><div class="chart-title">ğŸ“ˆ Games by Season</div><div class="chart-wrapper"><canvas id="seasonChart"></canvas></div></div>
        <div class="chart-container"><div class="chart-title">ğŸ¢ Sportsbook Coverage</div><div class="chart-wrapper"><canvas id="providerChart"></canvas></div></div>
      </div>
    </div>

    <div id="spreads" class="tab-content">
      <div class="analysis-section"><h2>ğŸ“ˆ Point Spread Analysis</h2><div class="insight-box"><strong>Key Insights:</strong> Point spreads reflect the expected margin of victory. Analyzing spread performance helps identify betting value and market inefficiencies.</div></div>
      <div id="spread-stats" class="stats-grid"></div>
      <div class="chart-container"><div class="chart-title">ğŸ“Š Spread Distribution</div><div class="chart-wrapper"><canvas id="spreadDistChart"></canvas></div></div>
      <div class="two-column">
        <div class="chart-container"><div class="chart-title">ğŸ  Home vs Away ATS Performance</div><div class="chart-wrapper"><canvas id="homeAwayATSChart"></canvas></div></div>
        <div class="chart-container"><div class="chart-title">ğŸ“ˆ ATS Performance by Season</div><div class="chart-wrapper"><canvas id="atsSeasonChart"></canvas></div></div>
      </div>
    </div>

    <div id="totals" class="tab-content">
      <div class="analysis-section"><h2>ğŸ¯ Over/Under Analysis</h2><div class="insight-box"><strong>Key Insights:</strong> Total points analysis reveals scoring trends and helps identify betting opportunities.</div></div>
      <div id="totals-stats" class="stats-grid"></div>
      <div class="chart-container"><div class="chart-title">ğŸ“Š Total Points Distribution</div><div class="chart-wrapper"><canvas id="totalsDistChart"></canvas></div></div>
      <div class="two-column">
        <div class="chart-container"><div class="chart-title">â¬†ï¸ Over/Under Performance</div><div class="chart-wrapper"><canvas id="overUnderChart"></canvas></div></div>
        <div class="chart-container"><div class="chart-title">ğŸ“ˆ Scoring Trends by Season</div><div class="chart-wrapper"><canvas id="scoringTrendChart"></canvas></div></div>
      </div>
    </div>

    <div id="trends" class="tab-content">
      <div class="analysis-section"><h2>ğŸ“… Historical Trends</h2><div class="insight-box"><strong>Key Insights:</strong> Historical trends reveal how betting markets evolved over time.</div></div>
      <div class="chart-container"><div class="chart-title">ğŸ“ˆ Average Spreads by Season</div><div class="chart-wrapper"><canvas id="avgSpreadTrendChart"></canvas></div></div>
      <div class="two-column">
        <div class="chart-container"><div class="chart-title">ğŸ¯ Average Totals Trend</div><div class="chart-wrapper"><canvas id="avgTotalsTrendChart"></canvas></div></div>
        <div class="chart-container"><div class="chart-title">ğŸ“Š Market Volume Trends</div><div class="chart-wrapper"><canvas id="volumeTrendChart"></canvas></div></div>
      </div>
    </div>

    <div id="conferences" class="tab-content">
      <div class="analysis-section"><h2>ğŸŸï¸ Conference Analysis</h2><div class="insight-box"><strong>Key Insights:</strong> Conferences differ in scoring, competitiveness, and betting patterns.</div></div>
      <div id="conference-stats" class="stats-grid"></div>
      <div class="chart-container"><div class="chart-title">ğŸŸï¸ Games by Conference</div><div class="chart-wrapper"><canvas id="conferenceGamesChart"></canvas></div></div>
      <div class="data-table"><h3>ğŸ“Š Conference Performance Table</h3><div id="conferenceTable"></div></div>
    </div>

    <div id="teams" class="tab-content">
      <div class="analysis-section">
        <h2>ğŸˆ Individual Team Analysis</h2>
        <div class="insight-box"><strong>Key Insights:</strong> Deep-dive into ATS, totals, home/away splits, and trends.</div>
        <div class="filter-grid" style="margin: 20px 0;">
          <div class="filter-item"><label for="teamSelectAnalysis">Select Team for Deep Analysis:</label><select id="teamSelectAnalysis" onchange="updateTeamAnalysis()"><option value="">Choose a Team...</option></select></div>
        </div>
      </div>
      <div id="team-stats" class="stats-grid"></div>
      <div class="two-column">
        <div class="chart-container"><div class="chart-title">ğŸ  Home vs Away Performance</div><div class="chart-wrapper"><canvas id="teamHomeAwayChart"></canvas></div></div>
        <div class="chart-container"><div class="chart-title">ğŸ“ˆ Season-by-Season ATS Record</div><div class="chart-wrapper"><canvas id="teamATSSeasonChart"></canvas></div></div>
      </div>
      <div class="chart-container"><div class="chart-title">â­ Team Performance vs Spreads</div><div class="chart-wrapper"><canvas id="teamSpreadChart"></canvas></div></div>
      <div class="two-column">
        <div class="chart-container"><div class="chart-title">ğŸ¯ Over/Under Performance</div><div class="chart-wrapper"><canvas id="teamTotalsChart"></canvas></div></div>
        <div class="chart-container"><div class="chart-title">ğŸ“Š Points Per Game Trends</div><div class="chart-wrapper"><canvas id="teamScoringChart"></canvas></div></div>
      </div>
      <div class="data-table"><h3>ğŸˆ Recent Games</h3><div id="teamGamesTable"></div></div>
    </div>

    <div id="yearly" class="tab-content">
      <div class="analysis-section">
        <h2>ğŸ“… Year-by-Year Analysis</h2>
        <div class="insight-box"><strong>Key Insights:</strong> Compare betting market performance across seasons.</div>
        <div class="filter-grid" style="margin: 20px 0;">
          <div class="filter-item"><label for="yearSelectAnalysis">Select Season for Deep Analysis:</label><select id="yearSelectAnalysis" onchange="updateYearAnalysis()"><option value="">Choose a Season...</option></select></div>
          <div class="filter-item"><label for="compareYearSelect">Compare with Season:</label><select id="compareYearSelect" onchange="updateYearAnalysis()"><option value="">No Comparison</option></select></div>
        </div>
      </div>
      <div id="year-stats" class="stats-grid"></div>
      <div class="two-column">
        <div class="chart-container"><div class="chart-title">ğŸ“Š Monthly Game Distribution</div><div class="chart-wrapper"><canvas id="yearMonthlyChart"></canvas></div></div>
        <div class="chart-container"><div class="chart-title">ğŸŸï¸ Conference Breakdown</div><div class="chart-wrapper"><canvas id="yearConferenceChart"></canvas></div></div>
      </div>
      <div class="chart-container"><div class="chart-title">ğŸ“ˆ Weekly Performance Trends</div><div class="chart-wrapper"><canvas id="yearWeeklyChart"></canvas></div></div>
      <div class="two-column">
        <div class="chart-container"><div class="chart-title">ğŸ¯ Spread Accuracy</div><div class="chart-wrapper"><canvas id="yearSpreadAccuracyChart"></canvas></div></div>
        <div class="chart-container"><div class="chart-title">ğŸ“Š Scoring Distribution</div><div class="chart-wrapper"><canvas id="yearScoringDistChart"></canvas></div></div>
      </div>
      <div class="data-table"><h3>ğŸ“ˆ Season Comparison Table</h3><div id="yearComparisonTable"></div></div>
    </div>
  </div>

  <div class="footer">
    <p>ğŸˆ NCAAF Betting Analysis Dashboard | Data covers multiple seasons</p>
    <p>Built with Chart.js | Optimized for mobile and desktop</p>
  </div>

  <script>
    // ====== Global state ======
    let allData = [];
    let filteredData = [];
    let charts = {};

    // ====== Tabs ======
    function showTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(tabName)?.classList.add('active');
      document.querySelector('[data-tab="'+tabName+'"]')?.classList.add('active');
    }
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.tab').forEach(tab => tab.addEventListener('click', () => showTab(tab.getAttribute('data-tab'))));
      loadData();
    });

    // ====== Data load (JSON file in repo) ======
    async function loadData() {
      try {
        const resp = await fetch('data/ncaaf-games.json', { cache: 'no-store' });
        if (!resp.ok) throw new Error('data/ncaaf-games.json not found');
        const json = await resp.json();
        allData = json;
        filteredData = allData;

        initializeFilters();
        updateAnalysis();

        document.getElementById('loading').style.display = 'none';
        document.getElementById('overview').classList.add('active');
      } catch (e) {
        showError('Failed to load data: ' + e.message + '<br><br>Make sure your JSON exists at <code>data/ncaaf-games.json</code>.');
      }
    }

    function showError(message) {
      const el = document.getElementById('loading');
      if (el) el.innerHTML = '<div class="error"><h2>âŒ Error Loading Data</h2><p>'+message+'</p></div>';
    }

    // ====== Filters ======
    function initializeFilters() {
      // Seasons
      const seasons = [...new Set(allData.map(r => r.Season))].filter(Boolean).sort((a,b)=>a-b);
      const seasonSel = document.getElementById('seasonFilter');
      seasons.forEach(s => { const o=document.createElement('option'); o.value=s; o.textContent=s; seasonSel.appendChild(o); });

      // Year analysis dropdowns
      const yearSel = document.getElementById('yearSelectAnalysis');
      const compareSel = document.getElementById('compareYearSelect');
      seasons.forEach(s => {
        const o1=document.createElement('option'); o1.value=s; o1.textContent=s; yearSel.appendChild(o1);
        const o2=document.createElement('option'); o2.value=s; o2.textContent=s; compareSel.appendChild(o2);
      });

      // Providers
      const providers = [...new Set(allData.map(r => r.LineProvider))].filter(Boolean).sort();
      const providerSel = document.getElementById('providerFilter');
      providers.forEach(p => { const o=document.createElement('option'); o.value=p; o.textContent=p; providerSel.appendChild(o); });

      // Conferences
      const conferences = [...new Set(allData.map(r => r.HomeConference))].filter(Boolean).sort();
      const confSel = document.getElementById('conferenceFilter');
      conferences.forEach(c => { const o=document.createElement('option'); o.value=c; o.textContent=c; confSel.appendChild(o); });

      // Weeks
      const weeks = [...new Set(allData.map(r => r.Week))].filter(Boolean).sort((a,b)=>a-b);
      const weekSel = document.getElementById('weekFilter');
      weeks.forEach(w => { const o=document.createElement('option'); o.value=w; o.textContent='Week '+w; weekSel.appendChild(o); });

      // Teams
      const teams = [...new Set([...allData.map(r=>r.HomeTeam_x), ...allData.map(r=>r.AwayTeam_x)])].filter(Boolean).sort();
      const teamSel = document.getElementById('teamFilter');
      const teamSelAnalysis = document.getElementById('teamSelectAnalysis');
      teams.forEach(t => {
        const o=document.createElement('option'); o.value=t; o.textContent=t; teamSel.appendChild(o);
        const o2=document.createElement('option'); o2.value=t; o2.textContent=t; teamSelAnalysis.appendChild(o2);
      });

      // Conference-Year
      const confYears = new Set();
      allData.forEach(r => {
        if (r.HomeConference && r.Season) confYears.add(r.HomeConference+' '+r.Season);
        if (r.AwayConference && r.Season) confYears.add(r.AwayConference+' '+r.Season);
      });
      const cySel = document.getElementById('conferenceYearFilter');
      [...confYears].sort().forEach(cy => { const o=document.createElement('option'); o.value=cy; o.textContent=cy; cySel.appendChild(o); });
    }

    function applyFilters() {
      const s = document.getElementById('seasonFilter')?.value || 'all';
      const p = document.getElementById('providerFilter')?.value || 'all';
      const c = document.getElementById('conferenceFilter')?.value || 'all';
      const w = document.getElementById('weekFilter')?.value || 'all';
      const t = document.getElementById('teamFilter')?.value || 'all';
      const cy = document.getElementById('conferenceYearFilter')?.value || 'all';

      filteredData = allData.filter(r => {
        if (s !== 'all' && r.Season != s) return false;
        if (p !== 'all' && r.LineProvider !== p) return false;
        if (c !== 'all' && r.HomeConference !== c && r.AwayConference !== c) return false;
        if (w !== 'all' && r.Week != w) return false;
        if (t !== 'all' && r.HomeTeam_x !== t && r.AwayTeam_x !== t) return false;
        if (cy !== 'all') {
          const [confName, confYear] = cy.split(' ');
          const homeOK = r.HomeConference === confName && r.Season == confYear;
          const awayOK = r.AwayConference === confName && r.Season == confYear;
          if (!homeOK && !awayOK) return false;
        }
        return true;
      });
    }

    // ====== Top-level update ======
    function updateAnalysis() {
      applyFilters();
      updateOverviewStats();
      updateCharts();
      updateSpreadAnalysis();
      updateTotalsAnalysis();
      updateConferenceAnalysis();
      updateHistoricalTrends();
    }

    // ====== Overview KPIs ======
    function updateOverviewStats() {
      const totalGames = filteredData.length;
      const withSpreads = filteredData.filter(r => r.Spread != null).length;
      const withTotals = filteredData.filter(r => r.OverUnder != null).length;
      const avgSpread = withSpreads ? filteredData.filter(r=>r.Spread!=null).reduce((s,r)=>s+Math.abs(r.Spread||0),0)/withSpreads : 0;
      const avgTotal = withTotals ? filteredData.filter(r=>r.OverUnder!=null).reduce((s,r)=>s+(r.OverUnder||0),0)/withTotals : 0;

      const html = `
        <div class="stat-card"><div class="stat-number">${totalGames.toLocaleString()}</div><div class="stat-label">Total Games</div></div>
        <div class="stat-card"><div class="stat-number">${withSpreads.toLocaleString()}</div><div class="stat-label">Completed Games</div></div>
        <div class="stat-card"><div class="stat-number">${avgSpread?avgSpread.toFixed(1):'N/A'}</div><div class="stat-label">Avg Spread</div></div>
        <div class="stat-card"><div class="stat-number">${avgTotal?avgTotal.toFixed(1):'N/A'}</div><div class="stat-label">Avg Total</div></div>`;
      document.getElementById('overview-stats').innerHTML = html;
    }

    // ====== Charts (Overview/Trends) ======
    function destroy(name){ if(charts[name]){ charts[name].destroy(); charts[name]=null; }}

    // The missing updateCharts function that calls the other chart functions
    function updateCharts() {
      updateSeasonChart();
      updateProviderChart();
    }

    // New/Corrected functions
    function updateSpreadAnalysis() {
        updateSpreadDistChart();
        updateHomeAwayATSChart();
        updateAtsSeasonChart();
    }
    
    function updateTotalsAnalysis() {
        updateTotalsDistChart();
        updateOverUnderChart();
    }
    
    function updateConferenceAnalysis() {
        updateConferenceGamesChart();
        updateConferenceTable();
    }
    
    function updateHistoricalTrends(){
        updateAvgSpreadTrendChart();
        updateAvgTotalsTrendChart();
        updateVolumeTrendChart();
    }

    function updateSeasonChart(){
      const counts={}; filteredData.forEach(r=>{ if(r.Season) counts[r.Season]=(counts[r.Season]||0)+1; });
      const ctx=document.getElementById('seasonChart'); if(!ctx) return; destroy('seasonChart');
      charts.seasonChart = new Chart(ctx.getContext('2d'), {
        type:'bar', data:{ labels:Object.keys(counts).sort(), datasets:[{ label:'Games', data:Object.values(counts), backgroundColor:'rgba(255,107,53,.8)', borderColor:'rgba(255,107,53,1)', borderWidth:2 }]},
        options:{ responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{ y:{ beginAtZero:true } } }
      });
    }

    function updateProviderChart(){
      const counts={}; filteredData.forEach(r=>{ if(r.LineProvider) counts[r.LineProvider]=(counts[r.LineProvider]||0)+1; });
      const sorted=Object.entries(counts).sort(([,a],[,b])=>b-a).slice(0,8);
      const ctx=document.getElementById('providerChart'); if(!ctx) return; destroy('providerChart');
      charts.providerChart=new Chart(ctx.getContext('2d'),{
        type:'doughnut', data:{ labels:sorted.map(([n])=>n), datasets:[{ data:sorted.map(([,c])=>c), backgroundColor:['#ff6b35','#f7931e','#2a5298','#1e3c72','#00b894','#00cec9','#6c5ce7','#a29bfe']}]},
        options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom' } } }
      });
    }
    
    // Spread Distribution Chart
    function updateSpreadDistChart() {
      const spreadData = filteredData.filter(r => r.Spread != null);
      if (spreadData.length === 0) return;
      const spreads = spreadData.map(r => r.Spread);
      const buckets = {};
      spreads.forEach(s => {
        const bucket = Math.round(s);
        buckets[bucket] = (buckets[bucket] || 0) + 1;
      });
      const sortedBuckets = Object.keys(buckets).sort((a,b) => a-b);
      const ctx = document.getElementById('spreadDistChart'); if(!ctx) return; destroy('spreadDistChart');
      charts.spreadDistChart = new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: sortedBuckets,
          datasets: [{
            label: 'Games',
            data: sortedBuckets.map(b => buckets[b]),
            backgroundColor: 'rgba(42,82,152,.8)',
            borderColor: 'rgba(42,82,152,1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true },
            x: { title: { display: true, text: 'Point Spread' } }
          }
        }
      });
    }

    // Home vs Away ATS Chart
    function updateHomeAwayATSChart() {
      const data = filteredData.filter(r => r.Completed && r.HomeScore != null && r.AwayScore != null && r.Spread != null);
      const ats = { homeCover: 0, homeFail: 0, awayCover: 0, awayFail: 0, push: 0 };
      data.forEach(game => {
        const actualSpread = game.HomeScore - game.AwayScore;
        const spreadLine = game.Spread;
        if (actualSpread > spreadLine) {
          if (spreadLine < 0) ats.homeCover++; else ats.awayFail++;
        } else if (actualSpread < spreadLine) {
          if (spreadLine < 0) ats.homeFail++; else ats.awayCover++;
        } else {
          ats.push++;
        }
      });
      const ctx = document.getElementById('homeAwayATSChart'); if(!ctx) return; destroy('homeAwayATSChart');
      charts.homeAwayATSChart = new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: ['Home Team', 'Away Team'],
          datasets: [{
            label: 'Covered',
            data: [ats.homeCover, ats.awayCover],
            backgroundColor: 'rgba(0,184,148,.8)'
          }, {
            label: 'Did Not Cover',
            data: [ats.homeFail, ats.awayFail],
            backgroundColor: 'rgba(255,107,53,.8)'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: { x: { stacked: true }, y: { stacked: true, beginAtZero: true } }
        }
      });
    }

    // ATS Performance by Season Chart
    function updateAtsSeasonChart() {
      const data = filteredData.filter(r => r.Completed && r.HomeScore != null && r.AwayScore != null && r.Spread != null);
      const seasons = [...new Set(data.map(r => r.Season))].sort();
      const seasonStats = {};
      seasons.forEach(s => seasonStats[s] = { total: 0, homeCovers: 0, awayCovers: 0 });
      data.forEach(game => {
        const actualSpread = game.HomeScore - game.AwayScore;
        const spreadLine = game.Spread;
        if (actualSpread > spreadLine) {
          if (spreadLine < 0) seasonStats[game.Season].homeCovers++;
          else seasonStats[game.Season].awayCovers++;
        } else if (actualSpread < spreadLine) {
          if (spreadLine < 0) seasonStats[game.Season].homeCovers++;
          else seasonStats[game.Season].awayCovers++;
        }
        seasonStats[game.Season].total++;
      });
      const ctx = document.getElementById('atsSeasonChart'); if(!ctx) return; destroy('atsSeasonChart');
      charts.atsSeasonChart = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
          labels: seasons,
          datasets: [{
            label: 'Home Team ATS %',
            data: seasons.map(s => (seasonStats[s].homeCovers / seasonStats[s].total) * 100),
            borderColor: 'rgba(42,82,152,1)',
            tension: 0.3
          }, {
            label: 'Away Team ATS %',
            data: seasons.map(s => (seasonStats[s].awayCovers / seasonStats[s].total) * 100),
            borderColor: 'rgba(255,107,53,1)',
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: { y: { beginAtZero: true, max: 100, title: { display: true, text: 'ATS %' } } }
        }
      });
    }

    // Total Points Distribution Chart
    function updateTotalsDistChart() {
      const data = filteredData.filter(r => r.Completed && r.HomeScore != null && r.AwayScore != null);
      if (data.length === 0) return;
      const totals = data.map(r => r.HomeScore + r.AwayScore);
      const buckets = {};
      totals.forEach(t => {
        const bucket = Math.round(t / 5) * 5;
        buckets[bucket] = (buckets[bucket] || 0) + 1;
      });
      const sortedBuckets = Object.keys(buckets).sort((a,b) => a-b);
      const ctx = document.getElementById('totalsDistChart'); if(!ctx) return; destroy('totalsDistChart');
      charts.totalsDistChart = new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: sortedBuckets,
          datasets: [{
            label: 'Games',
            data: sortedBuckets.map(b => buckets[b]),
            backgroundColor: 'rgba(0,184,148,.8)',
            borderColor: 'rgba(0,184,148,1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: {
            y: { beginAtZero: true },
            x: { title: { display: true, text: 'Total Points (Grouped)' } }
          }
        }
      });
    }

    // Over/Under Performance Chart
    function updateOverUnderChart() {
      const data = filteredData.filter(r => r.Completed && r.OverUnder != null && r.HomeScore != null && r.AwayScore != null);
      if (data.length === 0) return;
      const results = { over: 0, under: 0, push: 0 };
      data.forEach(game => {
        const total = game.HomeScore + game.AwayScore;
        if (total > game.OverUnder) {
          results.over++;
        } else if (total < game.OverUnder) {
          results.under++;
        } else {
          results.push++;
        }
      });
      const ctx = document.getElementById('overUnderChart'); if(!ctx) return; destroy('overUnderChart');
      charts.overUnderChart = new Chart(ctx.getContext('2d'), {
        type: 'doughnut',
        data: {
          labels: ['Overs', 'Unders', 'Pushes'],
          datasets: [{
            data: [results.over, results.under, results.push],
            backgroundColor: ['#ff6b35', '#2a5298', '#6c5ce7']
          }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
      });
    }

    // Average Spread Trend Chart
    function updateAvgSpreadTrendChart() {
      const data = filteredData.filter(r => r.Spread != null && r.Season != null);
      if (data.length === 0) return;
      const seasons = [...new Set(data.map(r => r.Season))].sort();
      const seasonSpreads = {};
      seasons.forEach(s => seasonSpreads[s] = { sum: 0, count: 0 });
      data.forEach(game => {
        seasonSpreads[game.Season].sum += Math.abs(game.Spread);
        seasonSpreads[game.Season].count++;
      });
      const avgSpreads = seasons.map(s => seasonSpreads[s].sum / seasonSpreads[s].count);
      const ctx = document.getElementById('avgSpreadTrendChart'); if(!ctx) return; destroy('avgSpreadTrendChart');
      charts.avgSpreadTrendChart = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
          labels: seasons,
          datasets: [{
            label: 'Avg. Absolute Spread',
            data: avgSpreads,
            borderColor: 'rgba(255,107,53,1)',
            fill: false,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, title: { display: true, text: 'Points' } } }
        }
      });
    }

    // Average Totals Trend Chart
    function updateAvgTotalsTrendChart() {
      const data = filteredData.filter(r => r.OverUnder != null && r.Season != null);
      if (data.length === 0) return;
      const seasons = [...new Set(data.map(r => r.Season))].sort();
      const seasonTotals = {};
      seasons.forEach(s => seasonTotals[s] = { sum: 0, count: 0 });
      data.forEach(game => {
        seasonTotals[game.Season].sum += game.OverUnder;
        seasonTotals[game.Season].count++;
      });
      const avgTotals = seasons.map(s => seasonTotals[s].sum / seasonTotals[s].count);
      const ctx = document.getElementById('avgTotalsTrendChart'); if(!ctx) return; destroy('avgTotalsTrendChart');
      charts.avgTotalsTrendChart = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
          labels: seasons,
          datasets: [{
            label: 'Avg. Total Points (Over/Under)',
            data: avgTotals,
            borderColor: 'rgba(0,184,148,1)',
            fill: false,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, title: { display: true, text: 'Points' } } }
        }
      });
    }

    // Volume Trend Chart
    function updateVolumeTrendChart() {
      const data = filteredData.filter(r => r.Completed && r.Season != null);
      if (data.length === 0) return;
      const seasons = [...new Set(data.map(r => r.Season))].sort();
      const seasonCounts = {};
      seasons.forEach(s => seasonCounts[s] = 0);
      data.forEach(game => seasonCounts[game.Season]++);
      const ctx = document.getElementById('volumeTrendChart'); if(!ctx) return; destroy('volumeTrendChart');
      charts.volumeTrendChart = new Chart(ctx.getContext('2d'), {
        type: 'line',
        data: {
          labels: seasons,
          datasets: [{
            label: 'Games per Season',
            data: seasons.map(s => seasonCounts[s]),
            borderColor: 'rgba(255,200,87,1)',
            fill: false,
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: { legend: { display: false } },
          scales: { y: { beginAtZero: true, title: { display: true, text: 'Number of Games' } } }
        }
      });
    }

    // Conference Games Chart
    function updateConferenceGamesChart() {
      const data = filteredData.filter(r => r.HomeConference);
      if (data.length === 0) return;
      const counts = {};
      data.forEach(r => counts[r.HomeConference] = (counts[r.HomeConference] || 0) + 1);
      const sorted = Object.entries(counts).sort(([,a],[,b])=>b-a);
      const ctx = document.getElementById('conferenceGamesChart'); if(!ctx) return; destroy('conferenceGamesChart');
      charts.conferenceGamesChart = new Chart(ctx.getContext('2d'), {
        type: 'bar',
        data: {
          labels: sorted.map(([n]) => n),
          datasets: [{
            label: 'Games',
            data: sorted.map(([,c]) => c),
            backgroundColor: 'rgba(42,82,152,.8)'
          }]
        },
        options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
      });
    }

    // Conference Table
    function updateConferenceTable() {
      const data = filteredData.filter(r => r.Completed && r.HomeConference && r.Spread != null && r.OverUnder != null);
      if (data.length === 0) {
        document.getElementById('conferenceTable').innerHTML = '<p>No data available for this selection.</p>';
        return;
      }
      const stats = {};
      data.forEach(game => {
        const homeConf = game.HomeConference;
        const awayConf = game.AwayConference;
        if (!stats[homeConf]) stats[homeConf] = { atsWins: 0, atsLosses: 0, overWins: 0, underWins: 0, games: 0 };
        if (!stats[awayConf]) stats[awayConf] = { atsWins: 0, atsLosses: 0, overWins: 0, underWins: 0, games: 0 };
        stats[homeConf].games++;
        stats[awayConf].games++;

        const actualSpread = game.HomeScore - game.AwayScore;
        const spreadLine = game.Spread;
        if (actualSpread > spreadLine) {
          if (spreadLine < 0) stats[homeConf].atsWins++; else stats[homeConf].atsLosses++;
        } else if (actualSpread < spreadLine) {
          if (spreadLine < 0) stats[homeConf].atsLosses++; else stats[homeConf].atsWins++;
        }

        const total = game.HomeScore + game.AwayScore;
        if (total > game.OverUnder) {
          stats[homeConf].overWins++; stats[awayConf].overWins++;
        } else if (total < game.OverUnder) {
          stats[homeConf].underWins++; stats[awayConf].underWins++;
        }
      });

      let tableHtml = `<table><thead><tr><th>Conference</th><th>Games</th><th>ATS Record (W-L)</th><th>ATS %</th><th>Over/Under Record (O-U)</th><th>O/U % (Over)</th></tr></thead><tbody>`;
      Object.keys(stats).sort().forEach(conf => {
        const s = stats[conf];
        const atsW = s.atsWins;
        const atsL = s.atsLosses;
        const over = s.overWins;
        const under = s.underWins;
        const total = atsW + atsL;
        const atsPct = total > 0 ? ((atsW / total) * 100).toFixed(1) + '%' : 'N/A';
        const ouPct = (over + under) > 0 ? ((over / (over + under)) * 100).toFixed(1) + '%' : 'N/A';
        tableHtml += `<tr><td>${conf}</td><td>${s.games}</td><td>${atsW}-${atsL}</td><td>${atsPct}</td><td>${over}-${under}</td><td>${ouPct}</td></tr>`;
      });
      tableHtml += `</tbody></table>`;
      document.getElementById('conferenceTable').innerHTML = tableHtml;
    }

    // Team Analysis functions (stubs)
    function updateTeamAnalysis() {
      // Logic for team analysis
    }

    // Year-by-Year Analysis functions (stubs)
    function updateYearAnalysis() {
      // Logic for year-by-year analysis
    }

  </script>
</body>
</html>
